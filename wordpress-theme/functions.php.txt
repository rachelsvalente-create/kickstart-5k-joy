<?php
/**
 * CorridaKickstart Theme Functions
 */

// Configurações do tema
function corridakickstart_setup() {
    // Suporte a título dinâmico
    add_theme_support('title-tag');
    
    // Suporte a imagens destacadas
    add_theme_support('post-thumbnails');
    
    // Suporte a HTML5
    add_theme_support('html5', array(
        'search-form',
        'comment-form',
        'comment-list',
        'gallery',
        'caption',
    ));
}
add_action('after_setup_theme', 'corridakickstart_setup');

// Enfileirar estilos e scripts
function corridakickstart_scripts() {
    // Estilo principal
    wp_enqueue_style('corridakickstart-style', get_stylesheet_uri());
    
    // Google Fonts (opcional)
    wp_enqueue_style('google-fonts', 'https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap', array(), null);
}
add_action('wp_enqueue_scripts', 'corridakickstart_scripts');

// Remover itens desnecessários do admin
function corridakickstart_clean_admin() {
    // Remove comentários se não forem necessários
    remove_menu_page('edit-comments.php');
}
add_action('admin_menu', 'corridakickstart_clean_admin');

// Custom Post Type para Depoimentos (opcional)
function corridakickstart_testimonials_post_type() {
    register_post_type('testimonial', array(
        'labels' => array(
            'name' => 'Depoimentos',
            'singular_name' => 'Depoimento',
        ),
        'public' => true,
        'has_archive' => false,
        'supports' => array('title', 'editor', 'thumbnail'),
        'menu_icon' => 'dashicons-format-quote',
    ));
}
add_action('init', 'corridakickstart_testimonials_post_type');

// Adicionar Custom Fields para o link do botão CTA
function corridakickstart_add_cta_metabox() {
    add_meta_box(
        'corridakickstart_cta_link',
        'Link do Botão CTA',
        'corridakickstart_cta_metabox_callback',
        'page',
        'side',
        'high'
    );
}
add_action('add_meta_boxes', 'corridakickstart_add_cta_metabox');

function corridakickstart_cta_metabox_callback($post) {
    wp_nonce_field('corridakickstart_save_cta_link', 'corridakickstart_cta_nonce');
    $value = get_post_meta($post->ID, '_corridakickstart_cta_link', true);
    echo '<label for="corridakickstart_cta_link">URL do link de pagamento:</label>';
    echo '<input type="url" id="corridakickstart_cta_link" name="corridakickstart_cta_link" value="' . esc_attr($value) . '" style="width:100%;margin-top:10px;" placeholder="https://seu-link-de-pagamento.com">';
}

function corridakickstart_save_cta_link($post_id) {
    if (!isset($_POST['corridakickstart_cta_nonce']) || !wp_verify_nonce($_POST['corridakickstart_cta_nonce'], 'corridakickstart_save_cta_link')) {
        return;
    }
    
    if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {
        return;
    }
    
    if (!current_user_can('edit_post', $post_id)) {
        return;
    }
    
    if (isset($_POST['corridakickstart_cta_link'])) {
        update_post_meta($post_id, '_corridakickstart_cta_link', sanitize_text_field($_POST['corridakickstart_cta_link']));
    }
}
add_action('save_post', 'corridakickstart_save_cta_link');

// Função helper para pegar o link CTA
function get_cta_link() {
    $link = get_post_meta(get_the_ID(), '_corridakickstart_cta_link', true);
    return $link ? $link : 'https://seu-link-de-pagamento.com';
}
?>
